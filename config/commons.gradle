ext {

    storeProperties = { buildDir, propertiesName, propertiesFile ->
        createFolder(buildDir + resourcesDir)
        def path = new File(buildDir + resourcesDir + propertiesName)
        propertiesFile.store(path.newWriter(), null)
    }

    addAuthenticationProperties = { props ->
        // module:registrationSv => bW9kdWxlOnJlZ2lzdHJhdGlvblN2 (Base64)
        props.setProperty("auth.username", "module")
        props.setProperty("auth.secret", "registrationSv")
        props.setProperty("oauth.token.endpoint", "http://${oauthHost}:${oauthPort}/oauth/check_token")
        return props
    }

    createCommonProperties = { ->
        Properties props = new Properties()
        props.setProperty("spring.application.name", applicationName)
        props.setProperty("default.locale", defaultLocale)
        props.setProperty("server.port", serverPort)
        props.setProperty("jmx.rmi.host", jmxHost)
        props.setProperty("jmx.rmi.port", jmxPort)
        props.setProperty("eureka.client.serviceUrl.defaultZone", "http://${eurekaHost}:${eurekaPort}/eureka/")
        props.setProperty("proxy.url", "http://${proxyHost}:${proxyPort}")
        addAuthenticationProperties(props)
        return props
    }

    createModulesProperties = { ->
        Properties props = new Properties()
        props.setProperty("modules.serviceDiscoveryModule.name", serviceDiscoveryModuleName)
        props.setProperty("modules.authenticationModule.name", authenticationModuleName)
        props.setProperty("modules.usersModule.name", usersModuleName)
        return props
    }

    copyCommonProperties = { buildDir ->
        copy {
            from("../CommonModule/src/main/resources")
            into(buildDir + resourcesDir)
        }
    }

    createFolder = { path ->
        def dir = new File(path)
        if (!dir.exists()) {
            dir.mkdirs()
        }
    }
}
